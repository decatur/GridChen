<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>GridChen Demo</title>

    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background-color: aliceblue;
        }
    </style>
</head>
<body>

<h1>One Simple Grid</h1>

<p>
    You can change row count via location hash.
</p>

<div>
    <grid-chen id="mygrid" style="display:inline-block;height:400px;"></grid-chen>
</div>

<script type="module">
    import {} from "./lunatic/gridchen.js"

    function createMyGrid(rowCount) {
        // Some sample data. Most likely this will come from the server via the Fetch API.
        let startDate = new Date('2017-01-01T00:00+01:00');

        const schemas = [
            {
                title: 'DateTime', width: 200, type: 'datetime', frequency: 'T1M', sortDirection: 1,
                simulate: (row) => new Date(startDate.getTime() + row * 1000 * 60 * 15)
            },
            {
                title: 'Date', width: 200, type: 'date',
                simulate: (row) => new Date(startDate.getTime() + row * 1000 * 60 * 15)
            },
            {
                title: 'DateTimeLocal', width: 200, type: 'datetimelocal', frequency: 'T1M',
                simulate: (row) => new Date(startDate.getTime() + row * 1000 * 60 * 15)
            },
            {title: 'Index', width: 50, type: 'number', fractionDigits: 0, simulate: (row, col) => row},
            {title: 'Col A', width: 50, type: 'number', fractionDigits: 1, simulate: (row, col) => row},
            {title: 'Col B', width: 100, type: 'number', fractionDigits: 2, simulate: (row, col) => row},
            {title: 'Col C', width: 100, type: 'string', simulate: (row, col) => `${row}#${col}`}
        ];

        function simulateData() {
            let data = Array(rowCount);
            for (let i = 0; i < rowCount; i++) {
                data[i] = schemas.map((schema, colIndex) => schema.simulate(i, colIndex));
            }
            data[3] = undefined;
            data[4][1] = undefined;
            return data
        }

        document.getElementById('mygrid').resetFromMatrix(schemas, simulateData());
    }

    /**
     * @param {HashChangeEvent} ev
     */
    window.onhashchange = function (ev) {
        let parts = window.location.hash.substring(1).split('&');
        let params = {rowcount: undefined};

        parts.forEach(function (part) {
            let keyValue = part.split('=');
            params[keyValue[0].toLowerCase()] = keyValue[1]
        });

        createMyGrid(Number(params.rowcount))
    };

    if (!window.location.hash.length) {
        // Set default
        window.location.hash = '#rowcount=1000'
    } else {
        window.onhashchange(null)
    }

</script>
</body>
</html>
