<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>GridChip Demo</title>

    <style>
        body {
            font-family: sans-serif; margin: 2em; background-color: aliceblue;
        }
    </style>
</head>
<body>

<h1>One Simple Grid</h1>

<p>
    You can change row count via location hash.
</p>

<div>
    <grid-chip id="mybantam1" style="display:inline-block;height:400px;"></grid-chip>
</div>

<script type="module">
    import {} from "./modules/gridchip.js"
    import {DateTimeIndex} from "./modules/chronos.js"

    function createMyGrid(rowCount) {
        // Some sample data. Most likely this will come from the server throw an async request.
        let startDate = new Date('2017-01-01T00:00:00Z');
        let dtIndex = DateTimeIndex.create(startDate, DateTimeIndex.minFreq * 15);

        const schemas = [
            {title: 'Date', width: 150, type: 'date', sort: 1, simulate: (row) => dtIndex.at(row)},
            {title: 'Index', width: 50, type: 'number', fractionDigits: 0, simulate: (row, col) => row},
            {title: 'Col A', width: 50, type: 'number', fractionDigits: 1, simulate: (row, col) => row},
            {title: 'Col B', width: 100, type: 'number', fractionDigits: 2, simulate: (row, col) => row},
            {title: 'Col C', width: 100, type: 'string', simulate: (row, col) => `${row}#${col}`}
        ];

        function simulateData() {
            let data = Array(rowCount);
            for (let i = 0; i < rowCount; i++) {
                data[i] = schemas.map((schema, colIndex) => schema.simulate(i, colIndex));
            }
            data[3] = undefined;
            data[4][1] = undefined;
            return data
        }

        document.getElementById('mybantam1').resetFromMatrix(schemas, simulateData());
    }

    /**
     * @param {HashChangeEvent} ev
     */
    window.onhashchange = function (ev) {
        let parts = window.location.hash.substring(1).split('&');
        let params = {rowcount: undefined};

        parts.forEach(function (part) {
            let keyValue = part.split('=');
            params[keyValue[0].toLowerCase()] = keyValue[1]
        });

        createMyGrid(Number(params.rowcount))
    };

    if (!window.location.hash.length) {
        // Set default
        window.location.hash = '#rowcount=1000'
    } else {
        window.onhashchange(null)
    }

</script>
</body>
</html>
