<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>GridChen Demo</title>

    <style>
        body {
            font-family: sans-serif;
            margin: 2em;
            background-color: aliceblue;
        }
    </style>
</head>
<body>

<h1>One Simple Grid</h1>

<p>
    You can change row count via location hash.
</p>

<div>
    <grid-chen id="mygrid" style="display:inline-block;height:400px;"></grid-chen>
</div>

<script type="module">
    import {} from "https://cdn.jsdelivr.net/gh/decatur/GridChen/modules/GridChen.js"
    import {createView} from "https://cdn.jsdelivr.net/gh/decatur/GridChen/modules/DataViews.js"

    function range(count) {
        return Array.from({length: count}, (_, i) => i);
    }

    function createMyGrid(rowCount) {
        const schema = {
            title: 'demo',
            type: 'array',
            items: {
                type: 'array',
                items: [  // tuple schema
                    {title: 'DateTime', width: 200, type: 'datetime', frequency: 'T1M', sortDirection: 1},
                    {title: 'Date', width: 200, type: 'date'},
                    {title: 'DateTimeLocal', width: 200, type: 'datetimelocal', frequency: 'T1M'},
                    {title: 'Index', width: 50, type: 'number', fractionDigits: 0},
                    {title: 'Col A', width: 50, type: 'number', fractionDigits: 1},
                    {title: 'Col B', width: 100, type: 'number', fractionDigits: 2},
                    {title: 'Col C', width: 100, type: 'string'}
                ]
            }
        };

        // We simulate the data. Most likely this will come from the server via the Fetch API.
        let startDate = new Date('2017-01-01T00:00+01:00');
        const simulate = {
            DateTime: (row) => new Date(startDate.getTime() + row * 1000 * 60 * 15),
            Date: (row) => new Date(startDate.getTime() + row * 1000 * 60 * 15),
            DateTimeLocal: (row) => new Date(startDate.getTime() + row * 1000 * 60 * 15),
            Height: (row) => row,
            Index: (row) => row,
            'Col A': (row) => row,
            'Col B': (row) => row,
            'Col C': (row) => `row ${row}`
        };


        function simulateRows() {
            let rows = range(rowCount).map(i => schema.items.items.map((schema) => simulate[schema.title](i)));
            delete rows[3];
            delete rows[4][1];
            return rows
        }

        document.getElementById('mygrid').resetFromView(createView(schema, simulateRows()));
    }

    /**
     * @param {HashChangeEvent} ev
     */
    window.onhashchange = function (ev) {
        let parts = window.location.hash.substring(1).split('&');
        let params = {rowcount: undefined};

        parts.forEach(function (part) {
            let keyValue = part.split('=');
            params[keyValue[0].toLowerCase()] = keyValue[1]
        });

        createMyGrid(Number(params.rowcount))
    };

    if (!window.location.hash.length) {
        // Set default
        window.location.hash = '#rowcount=1000'
    } else {
        window.onhashchange(null)
    }

</script>
</body>
</html>
