<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>module name</title>
    <link id="favicon" rel="shortcut icon" type="image/png" href="yellow.png">
    <script src="../theme.js"></script>
</head>
<body>
<h1><a href="../index.html">GridChen Index</a> / Running Unit Test <span id="moduleName"/></h1>
<p>
    Open JavaScript console for details
</p>

</body>

<script src="jsonpatch.min.js"></script>

<script type="module">
    import {getErrorCount} from './utils.js'

    const favLink = document.getElementById('favicon');
    const m = window.location.search.match(/module=([^&]+)/);
    if (!m) {
        throw new Error('Page must be loaded with module query');
    }
    const moduleName = window.location.search.match(/module=([^&]+)/)[1];
    document.title = moduleName;
    document.getElementById('moduleName').textContent = moduleName;

    import(`./${moduleName}.js`)
        .then(function() {
            favLink.setAttribute('href', `${getErrorCount()?'red':'green'}.png`)
        })
        .catch(() => favLink.setAttribute('href', `red.png`));


    window.setTimeout(function() {
        if (window.opener) {
            window.opener.moduleDone(moduleName);
        }
    }, 1000);

</script>
</html>